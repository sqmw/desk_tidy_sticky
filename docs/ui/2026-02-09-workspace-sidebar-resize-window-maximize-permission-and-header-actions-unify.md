# Workspace 左侧分栏拖拽 + 窗口最大化权限与顶部按钮统一（2026-02-09）

## 本次问题
1. 需要左侧侧栏像详情区一样可拖拽调整，且最大宽度锁在当前视觉宽度。
2. `toggleWindowMaximize(workspace)` 报权限错误（`window.toggle_maximize not allowed`）。
3. 顶部右上角按钮风格不统一，破坏整体视觉一致性。

## 方案与实现

### 1) 左侧侧栏可拖拽调宽（上限 260）
- workspace 主网格改为三列：`sidebar + splitter + main`。
- 新增 `sidebar-splitter` 拖拽条，支持：
  - 按住拖动调整侧栏宽度；
  - 双击恢复默认宽度 `260px`。
- 宽度约束：`min 184px / max 260px`。

### 2) 修复窗口最大化权限
- 在 `src-tauri/capabilities/default.json` 增加：
  - `core:window:allow-toggle-maximize`
  - `core:window:allow-is-maximized`

### 3) 顶部右侧按钮视觉统一
- 统一按钮基础高度、圆角、hover/active 反馈。
- 图标按钮（主题、最大化）统一为方形尺寸。
- 文本按钮（返回简洁、隐藏窗口）与图标按钮保持同一节奏和边框体系。
- 已去掉“收起侧栏”按钮（按需求）。

## 影响文件
- `src/routes/workspace/+page.svelte`
- `src/lib/components/workspace/WorkspaceWindowBar.svelte`
- `src-tauri/capabilities/default.json`

## 验证点
- 左侧侧栏可拖拽调宽，且不会超过 260。
- 最大化按钮不再报权限错误。
- 顶部右侧按钮外观和交互反馈一致。

## 左侧侧栏收起宽度回归
- 问题：左侧分栏最小宽度过大（184px），无法拖到历史“收起侧栏”状态。
- 调整：
  1. 左侧最小宽度从 `184px` 下调为 `86px`；
  2. 拖拽释放时，若宽度 <= `120px`，自动吸附到 `86px`；
  3. 当宽度 <= `104px` 时，侧栏进入 `collapsed` 视觉模式（复用原侧栏组件能力）。
- 结果：左侧可拖拽进入接近原“收起侧栏”的状态，且手感更稳定。

## 顶部右侧按钮重新编排（用户习惯导向）
- 问题：右上角按钮顺序、强调层级和视觉风格不统一，影响可读性和操作习惯。
- 调整：
  1. 重排为三段：`工具组(主题/最大化)` -> `返回简洁` -> `隐藏窗口`；
  2. 工具组使用统一图标按钮（相同尺寸与边框节奏）；
  3. 文本按钮统一高度、圆角、hover/active 动效；
  4. `返回简洁` 从过度强调改为常规次级动作，`隐藏窗口` 保留危险语义但降低突兀感；
  5. 替换 Unicode 符号为统一 SVG 图标，避免视觉不一致。
- 结果：按钮层级更清晰，布局更符合桌面应用右上角动作区的使用习惯。

## 顶部右侧动作区再次优化（窗口习惯对齐）
- 调整诉求：
  1. `隐藏窗口` 文案过于“设置化”，改为标准关闭符号；
  2. `返回简洁` 文案更正式；
  3. 最大化应放在关闭按钮旁边。
- 实现：
  - 关闭动作改为 `X` 图标按钮（保留 tooltip 文案）；
  - `switchToCompact` 文案改为 `简洁模式 / Compact mode`；
  - 右上角改为窗口控制组：`最大化` 紧邻 `关闭`；
  - 主题按钮与窗口控制组分离，层级更清晰。
- 结果：更符合桌面应用常见操作习惯与视觉预期。

## 修复：详情“放大”后空白
- 现象：点击详情面板“放大”后，主内容区域可能出现整体空白（无报错）。
- 原因：此前放大实现使用了条件分支切换布局模式，存在在某些状态下落入空渲染的风险。
- 修复策略（稳定优先）：
  1. 取消“放大态单独分支渲染”；
  2. 放大仅改为“将详情宽度扩展到可用上限（约 78%）”；
  3. 还原时恢复到放大前宽度；
  4. 关闭详情时自动清理放大状态。
- 结果：不再出现点击放大后内容消失，列表与详情始终可见且状态可回退。

## 暗黑模式关闭按钮配色修复
- 问题：暗黑模式下顶部 `X` 关闭按钮与详情面板 `关闭` 按钮仍偏亮色体系，视觉不协调。
- 处理：
  - 为 `WorkspaceWindowBar` 的 `.bar-btn.close` 增加暗黑主题专属样式（常态与 hover）。
  - 为 `WorkspaceNoteInspector` 的 `.btn.danger` 增加暗黑主题专属样式（常态与 hover）。
- 结果：两个关闭按钮在深色背景下色温、对比与危险语义一致，不再“亮色突兀”。

## 交互调整：移除详情“放大”按钮，改为拖拽分栏收起/展开列表
- 背景：放大按钮与“还原分栏”语义重叠，且容易引入状态复杂度。
- 调整：
  1. 移除详情面板中的“放大”按钮；
  2. 列表与详情之间仅通过分割条拖拽控制：
     - 向左拖到阈值可将列表完全收起；
     - 向右拖回可重新展开列表。
- 关键实现：
  - 增加 `inspectorListCollapsed` 状态；
  - `.workbench-shell.inspector-open.list-collapsed` 下网格列改为 `0 8px 1fr`；
  - 拖拽阈值：收起阈值 `56px`，再展开阈值 `220px`。
- 结果：交互更单一、直观，避免“放大/还原分栏”双重心智负担。

## 暗色主题：关闭按钮去红化
- 问题：暗色主题下右上角关闭按钮和详情关闭按钮仍是红底红字，视觉过于跳出。
- 调整：
  - 暗色常态改为中性按钮（沿用暗色面板色）；
  - hover 时仅使用轻微暖色提醒（橙系）而非强红警示。
- 影响：
  - `WorkspaceWindowBar` 的 `X` 关闭按钮
  - `WorkspaceNoteInspector` 的 `关闭` 按钮
- 结果：暗色整体更统一，仍保留可感知的关闭动作反馈。

## 浅色主题：关闭按钮去红化
- 用户要求：浅色模式下也不使用红色关闭按钮。
- 调整：
  - 顶部 `X` 关闭按钮（light）改为中性边框/中性文字/中性背景；
  - 详情面板 `关闭` 按钮（light）改为中性样式，不再使用 danger 红色。
- 结果：浅色与暗色都采用一致的中性关闭风格，仅保留常规 hover 反馈。
