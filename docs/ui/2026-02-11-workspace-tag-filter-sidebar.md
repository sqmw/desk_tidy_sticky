# Workspace 侧栏标签筛选（2026-02-11）

## 目标

在工作台左侧增加“标签筛选”，让标签不仅能编辑，还能用于浏览和筛选。

## 交互规则

1. 侧栏新增“标签筛选”区块，显示当前视图下的标签统计。
2. 点击某个标签后，仅展示包含该标签的笔记。
3. 支持“全部标签”一键清空标签筛选。
4. 标签筛选与搜索框叠加生效（先按标签过滤，再走搜索匹配）。
5. 若当前选中的标签在当前视图已不存在，自动清空，避免空状态卡死。
6. 在某标签筛选状态下创建笔记（含“新建笔记”和“写长文档”）会自动附加该标签，避免新建后被筛选条件隐藏。
7. 当标签很多时，左侧“视图+标签”区域整体进入自适应滚动，不再依赖固定高度，避免小窗口下按钮被挤出可视区。

## 视图范围

标签统计按“当前视图”计算：

- 全部 / 待办 / 四象限：统计未删除且未归档的数据。
- 已归档：统计归档数据。
- 回收站：统计回收站数据。

## 同步修正：待办视图语义

本次同时修正了 `todo` 视图行为，使其与文案“待办（未完成）”一致：

1. `todo` 仅展示未完成项（`!isDone`）。
2. 相关重排持久化逻辑仅作用于未完成项，避免隐形条目顺序错乱。

## 涉及文件

- `src/routes/workspace/+page.svelte`
  - 新增 `selectedTag` 状态。
  - 新增按视图取数与标签匹配辅助函数。
  - 新增 `noteTagEntries` / `taggedNoteCount` 派生数据。
  - 将标签筛选纳入主列表过滤链路。
- `src/lib/components/workspace/WorkspaceSidebar.svelte`
  - 新增标签筛选区块和标签列表样式。
  - 增加 `onSetSelectedTag` 事件入口。
  - 将“笔记筛选块”改为可伸缩容器，内部 `view-sections` 统一滚动。
- `src/lib/strings.js`
  - 新增多语言文案：
    - `workspaceTagsFilter`
    - `workspaceTagsAll`
    - `workspaceTagsEmpty`

## 验证

- `npm run check` 通过。
- `cargo check` 通过（仅保留历史 warning）。
