import { getWorkspaceThemePreset } from "$lib/workspace/theme/theme-presets.js";

const THEME_TOKEN_ORDER = [
  "--ws-text-strong",
  "--ws-text",
  "--ws-muted",
  "--ws-accent",
  "--ws-panel-bg",
  "--ws-card-bg",
  "--ws-btn-bg",
  "--ws-btn-hover",
  "--ws-btn-active",
  "--ws-badge-bg",
  "--ws-badge-border",
  "--ws-border",
  "--ws-border-soft",
  "--ws-border-hover",
  "--ws-border-active",
  "--ws-scrollbar-track",
  "--ws-scrollbar-thumb",
  "--ws-scrollbar-thumb-hover",
  "--ws-input-bg",
  "--ws-input-border",
  "--ws-input-text",
  "--ws-workspace-bg",
];

const WORKSPACE_SELECTOR_INDEX = [
  "action-btn",
  "action-cluster",
  "actions",
  "add-input",
  "back",
  "bar-btn",
  "block-title",
  "brand",
  "brand-pill",
  "break-actions",
  "break-controls",
  "break-fullscreen",
  "break-fullscreen-actions",
  "break-fullscreen-card",
  "break-fullscreen-sub",
  "break-fullscreen-title",
  "break-head",
  "break-meta",
  "break-profile-hint",
  "break-profile-inputs",
  "break-profile-label",
  "break-profile-row",
  "break-profile-toggle",
  "break-prompt-card",
  "break-prompt-head",
  "break-prompt-sub",
  "break-state",
  "break-tab-empty",
  "break-tab-panel",
  "btn",
  "card",
  "card-body",
  "card-top",
  "chip-btn",
  "circle",
  "clear",
  "clear-btn",
  "close",
  "close-btn",
  "content",
  "create-actions",
  "create-bar",
  "css-editor",
  "danger",
  "date",
  "day-chip",
  "deadline-action-btn",
  "deadline-actions",
  "deadline-alert-dot",
  "deadline-block",
  "deadline-count",
  "deadline-empty",
  "deadline-head",
  "deadline-item",
  "deadline-list",
  "deadline-meta",
  "deadline-progress",
  "deadline-progress-row",
  "deadline-state",
  "deadline-title",
  "dialog-body",
  "dialog-head",
  "dist-empty",
  "dist-list",
  "dist-name",
  "dist-row",
  "dist-title",
  "dist-val",
  "dist-wrap",
  "dot",
  "draft-break-hint",
  "draft-break-inputs",
  "draft-break-label",
  "draft-break-row",
  "draft-break-toggle",
  "drag-area",
  "drag-handle",
  "editor",
  "empty",
  "field-add",
  "field-end",
  "field-recur",
  "field-start",
  "field-target",
  "field-title",
  "focus-hub",
  "focus-main",
  "focus-slot",
  "focus-tab",
  "focus-tabs",
  "ghost-btn",
  "ghost-inner",
  "ghost-text",
  "ghost-top",
  "grid",
  "header-actions",
  "header-left",
  "heart",
  "heat-cell",
  "heatmap-grid",
  "heatmap-title",
  "heatmap-wrap",
  "hint",
  "icon-btn",
  "initial-view",
  "initial-view-label",
  "initial-view-select",
  "inspector",
  "inspector-header",
  "main-tab-btn",
  "main-tabs",
  "markdown",
  "meta",
  "mode-cluster",
  "modules-block",
  "note-filters-block",
  "notify-tip",
  "phase",
  "phase-icon",
  "phase-progress",
  "phase-progress-fill",
  "placeholder-inner",
  "planner-card",
  "planner-form",
  "planner-head",
  "planner-slot",
  "preset-chip",
  "preset-group",
  "primary",
  "primary-btn",
  "priority",
  "priority-item",
  "priority-menu",
  "priority-menu-caption",
  "priority-menu-divider",
  "priority-tag",
  "priority-tag-add",
  "priority-tag-create",
  "priority-tag-input",
  "priority-tag-item",
  "priority-tag-list",
  "priority-wrap",
  "quadrant-actions",
  "quadrant-board",
  "quadrant-cell",
  "quadrant-count",
  "quadrant-drag-ghost",
  "quadrant-head",
  "quadrant-head-top",
  "quadrant-list",
  "quadrant-note-card",
  "quadrant-placeholder",
  "query-bar",
  "quick-cluster",
  "reminder-mode-row",
  "schedule-hint",
  "schedule-independent-editor",
  "schedule-row",
  "schedule-title",
  "search",
  "section-height-splitter",
  "section-toggle",
  "session-actions",
  "session-btn",
  "session-row",
  "session-scope",
  "session-selectors",
  "session-state",
  "session-state-wrap",
  "setting-row",
  "setting-stack",
  "setting-stack-head",
  "settings-backdrop",
  "settings-dialog",
  "shape",
  "sidebar",
  "sidebar-actions",
  "sidebar-block",
  "sidebar-block-head",
  "sidebar-body",
  "sort-control",
  "stat",
  "stats-card",
  "stats-quick",
  "stats-shell",
  "stats-toggle",
  "step-btn",
  "strict-mode-row",
  "strong",
  "summary",
  "summary-chip",
  "tag-chip",
  "tag-empty",
  "tag-filter",
  "tag-filter-btn",
  "tag-list",
  "tag-name",
  "tag-row",
  "target-input",
  "task-actions",
  "task-break-profile",
  "task-edit-grid",
  "task-item",
  "task-list",
  "task-main",
  "task-progress",
  "task-progress-bar",
  "task-progress-fill",
  "task-progress-head",
  "task-select",
  "task-time",
  "task-title",
  "text",
  "theme-actions",
  "theme-card",
  "theme-card-chip",
  "theme-card-line",
  "theme-card-preview",
  "theme-card-title",
  "theme-custom-head",
  "theme-import-input",
  "theme-item",
  "theme-menu",
  "theme-preset-grid",
  "theme-preset-stack",
  "timer",
  "timer-actions",
  "timer-card",
  "timer-head",
  "timer-hero",
  "timer-meta",
  "timer-row",
  "timer-settings",
  "timer-settings-actions",
  "timer-slot",
  "tiny",
  "title",
  "toolbar",
  "view-btn",
  "view-count",
  "view-list",
  "view-list-secondary",
  "view-sections",
  "view-separator",
  "weekday-picker",
  "window-actions",
  "window-bar",
  "window-cluster",
  "workbench",
];

function buildThemeTokenSection() {
  const preset = getWorkspaceThemePreset("light");
  const vars = preset.vars;
  const lines = [
    ".workspace {",
    "  /* 核心主题变量：改这里即可影响所有模块 */",
  ];
  for (const token of THEME_TOKEN_ORDER) {
    const value = vars[token] || "";
    lines.push(`  ${token}: ${value};`);
  }
  lines.push("}");
  return lines.join("\n");
}

function buildModuleDefaultSection() {
  return [
    "/* ============================= */",
    "/* 全局容器与滚动 */",
    "/* ============================= */",
    ".workspace-viewport {",
    "  background: var(--ws-workspace-bg);",
    "}",
    "",
    ".workspace {",
    "  color: var(--ws-text-strong);",
    "  background: var(--ws-workspace-bg);",
    "}",
    "",
    ".workspace .main {",
    "  background: transparent;",
    "}",
    "",
    ".workspace .focus-pane,",
    ".workspace .workbench,",
    ".workspace .sidebar,",
    ".workspace .content,",
    ".workspace .deadline-list,",
    ".workspace .tag-list,",
    ".workspace .inspector .content {",
    "  scrollbar-color: var(--ws-scrollbar-thumb) var(--ws-scrollbar-track);",
    "}",
    "",
    ".workspace ::-webkit-scrollbar {",
    "  width: 8px;",
    "  height: 8px;",
    "}",
    "",
    ".workspace ::-webkit-scrollbar-track {",
    "  background: var(--ws-scrollbar-track);",
    "  border-radius: 999px;",
    "}",
    "",
    ".workspace ::-webkit-scrollbar-thumb {",
    "  background: var(--ws-scrollbar-thumb);",
    "  border-radius: 999px;",
    "}",
    "",
    ".workspace ::-webkit-scrollbar-thumb:hover {",
    "  background: var(--ws-scrollbar-thumb-hover);",
    "}",
    "",
    ".workspace input,",
    ".workspace textarea,",
    ".workspace select {",
    "  color: var(--ws-input-text);",
    "  background: var(--ws-input-bg);",
    "  border: 1px solid var(--ws-input-border);",
    "  border-radius: 10px;",
    "}",
    "",
    ".workspace .sidebar-splitter,",
    ".workspace .inspector-splitter,",
    ".workspace .section-height-splitter {",
    "  background: color-mix(in srgb, var(--ws-border-soft) 72%, transparent);",
    "}",
    "",
    "/* ============================= */",
    "/* 顶部窗口栏 */",
    "/* ============================= */",
    ".workspace .window-bar {",
    "  border: 1px solid var(--ws-border);",
    "  background: color-mix(in srgb, var(--ws-panel-bg) 92%, transparent);",
    "  border-radius: 14px;",
    "}",
    "",
    ".workspace .window-bar .title {",
    "  color: var(--ws-text-strong);",
    "  font-weight: 700;",
    "}",
    "",
    ".workspace .window-bar .action-cluster {",
    "  border: 1px solid var(--ws-border-soft);",
    "  background: color-mix(in srgb, var(--ws-panel-bg) 74%, transparent);",
    "}",
    "",
    ".workspace .window-bar .bar-btn {",
    "  border: 1px solid var(--ws-border-soft);",
    "  background: var(--ws-btn-bg);",
    "  color: var(--ws-text);",
    "}",
    "",
    ".workspace .window-bar .bar-btn:hover {",
    "  border-color: var(--ws-border-hover);",
    "  background: var(--ws-btn-hover);",
    "}",
    "",
    ".workspace .window-bar .close-btn {",
    "  color: color-mix(in srgb, #dc2626 72%, var(--ws-text));",
    "  border-color: color-mix(in srgb, #f87171 56%, var(--ws-border-soft));",
    "}",
    "",
    ".workspace .window-bar .theme-menu {",
    "  border: 1px solid var(--ws-border-soft);",
    "  background: var(--ws-panel-bg);",
    "  border-radius: 10px;",
    "}",
    "",
    ".workspace .window-bar .theme-item {",
    "  color: var(--ws-text);",
    "}",
    "",
    ".workspace .window-bar .theme-item.active {",
    "  border-color: var(--ws-border-active);",
    "  background: var(--ws-btn-hover);",
    "}",
    "",
    "/* ============================= */",
    "/* 左侧栏（导航/视图/今日任务/设置） */",
    "/* ============================= */",
    ".workspace .sidebar {",
    "  color: var(--ws-text);",
    "  background: color-mix(in srgb, var(--ws-panel-bg) 92%, transparent);",
    "  border-right: 1px solid var(--ws-border-soft);",
    "}",
    "",
    ".workspace .sidebar .brand-pill {",
    "  background: var(--ws-badge-bg);",
    "  border: 1px solid var(--ws-badge-border);",
    "  color: var(--ws-accent);",
    "}",
    "",
    ".workspace .sidebar .brand h1 {",
    "  color: var(--ws-text-strong);",
    "}",
    "",
    ".workspace .sidebar .brand p {",
    "  color: var(--ws-muted);",
    "}",
    "",
    ".workspace .sidebar .sidebar-block {",
    "  border: 1px solid var(--ws-border);",
    "  background: color-mix(in srgb, var(--ws-card-bg) 88%, transparent);",
    "  border-radius: 16px;",
    "}",
    "",
    ".workspace .sidebar .block-title {",
    "  color: var(--ws-muted);",
    "}",
    "",
    ".workspace .sidebar .main-tab-btn,",
    ".workspace .sidebar .view-btn,",
    ".workspace .sidebar .tag-filter-btn,",
    ".workspace .sidebar .ghost-btn,",
    ".workspace .sidebar .deadline-action-btn {",
    "  border: 1px solid var(--ws-border-soft);",
    "  background: var(--ws-btn-bg);",
    "  color: var(--ws-text);",
    "}",
    "",
    ".workspace .sidebar .main-tab-btn.active,",
    ".workspace .sidebar .view-btn.active,",
    ".workspace .sidebar .tag-filter-btn.active {",
    "  border-color: var(--ws-border-active);",
    "  background: var(--ws-btn-active);",
    "  color: var(--ws-text-strong);",
    "}",
    "",
    ".workspace .sidebar .view-count {",
    "  border: 1px solid var(--ws-badge-border);",
    "  background: var(--ws-badge-bg);",
    "  color: var(--ws-text);",
    "}",
    "",
    ".workspace .sidebar .deadline-item {",
    "  border: 1px solid var(--ws-border-soft);",
    "  background: var(--ws-card-bg);",
    "  color: var(--ws-text);",
    "}",
    "",
    ".workspace .sidebar .deadline-state {",
    "  border: 1px solid var(--ws-badge-border);",
    "  background: var(--ws-badge-bg);",
    "  color: var(--ws-accent);",
    "}",
    "",
    ".workspace .sidebar .deadline-item.overdue {",
    "  border-color: color-mix(in srgb, #ef4444 55%, var(--ws-border-soft));",
    "  background: color-mix(in srgb, #ef4444 12%, var(--ws-card-bg));",
    "}",
    "",
    "/* ============================= */",
    "/* 创建 + 搜索工具栏 */",
    "/* ============================= */",
    ".workspace .toolbar {",
    "  border: 1px solid var(--ws-border);",
    "  border-radius: 14px;",
    "  background: color-mix(in srgb, var(--ws-panel-bg) 90%, transparent);",
    "}",
    "",
    ".workspace .toolbar .add-input,",
    ".workspace .toolbar .search {",
    "  border: 1px solid var(--ws-border-soft);",
    "  background: var(--ws-card-bg);",
    "  color: var(--ws-text);",
    "}",
    "",
    ".workspace .toolbar .primary-btn,",
    ".workspace .toolbar .ghost-btn {",
    "  border: 1px solid var(--ws-border-soft);",
    "  background: var(--ws-btn-bg);",
    "  color: var(--ws-text);",
    "}",
    "",
    ".workspace .toolbar .primary-btn {",
    "  border-color: var(--ws-border-active);",
    "  background: linear-gradient(180deg, color-mix(in srgb, var(--ws-accent) 26%, #334155) 0%, #273a57 100%);",
    "  color: #f8fafc;",
    "}",
    "",
    "/* ============================= */",
    "/* 便笺看板与四象限 */",
    "/* ============================= */",
    ".workspace .workbench {",
    "  color: var(--ws-text);",
    "}",
    "",
    ".workspace .summary-chip,",
    ".workspace .tag-chip,",
    ".workspace .priority-tag {",
    "  border: 1px solid var(--ws-badge-border);",
    "  background: var(--ws-badge-bg);",
    "  color: var(--ws-accent);",
    "}",
    "",
    ".workspace .card,",
    ".workspace .quadrant-note-card {",
    "  border: 1px solid var(--ws-border-soft);",
    "  background: var(--ws-card-bg);",
    "  color: var(--ws-text);",
    "  border-radius: 16px;",
    "}",
    "",
    ".workspace .card .date,",
    ".workspace .quadrant-note-card .date,",
    ".workspace .card .meta {",
    "  color: var(--ws-muted);",
    "}",
    "",
    ".workspace .card .text,",
    ".workspace .quadrant-note-card .text {",
    "  color: var(--ws-text);",
    "}",
    "",
    ".workspace .actions .action-btn,",
    ".workspace .quadrant-actions .action-btn,",
    ".workspace .drag-handle {",
    "  border: 1px solid var(--ws-border-soft);",
    "  background: var(--ws-btn-bg);",
    "  color: var(--ws-text);",
    "}",
    "",
    ".workspace .actions .action-btn.priority,",
    ".workspace .quadrant-actions .action-btn.priority {",
    "  border-color: var(--ws-border-active);",
    "  background: var(--ws-btn-active);",
    "  color: var(--ws-text-strong);",
    "}",
    "",
    ".workspace .actions .action-btn.danger {",
    "  border-color: color-mix(in srgb, #ef4444 52%, var(--ws-border-soft));",
    "  color: color-mix(in srgb, #dc2626 78%, var(--ws-text));",
    "}",
    "",
    ".workspace .quadrant-board,",
    ".workspace .quadrant-cell {",
    "  border-color: var(--ws-border-soft);",
    "}",
    "",
    ".workspace .priority-menu {",
    "  border: 1px solid var(--ws-border-soft);",
    "  background: var(--ws-panel-bg);",
    "  color: var(--ws-text);",
    "}",
    "",
    ".workspace .priority-item:hover,",
    ".workspace .priority-tag-item:hover {",
    "  background: var(--ws-btn-hover);",
    "}",
    "",
    ".workspace .quadrant-placeholder,",
    ".workspace .quadrant-drag-ghost {",
    "  border: 1px dashed var(--ws-border-active);",
    "  background: color-mix(in srgb, var(--ws-accent) 8%, transparent);",
    "}",
    "",
    "/* ============================= */",
    "/* 详情检查器 */",
    "/* ============================= */",
    ".workspace .inspector {",
    "  border: 1px solid var(--ws-border);",
    "  background: var(--ws-card-bg);",
    "  color: var(--ws-text);",
    "}",
    "",
    ".workspace .inspector-header {",
    "  border-bottom: 1px solid var(--ws-border-soft);",
    "}",
    "",
    ".workspace .inspector .title {",
    "  color: var(--ws-text-strong);",
    "}",
    "",
    ".workspace .inspector .meta,",
    ".workspace .inspector .hint {",
    "  color: var(--ws-muted);",
    "}",
    "",
    ".workspace .inspector .btn {",
    "  border: 1px solid var(--ws-border-soft);",
    "  background: var(--ws-btn-bg);",
    "  color: var(--ws-text);",
    "}",
    "",
    ".workspace .inspector .btn.primary {",
    "  border-color: var(--ws-border-active);",
    "  background: var(--ws-btn-active);",
    "  color: var(--ws-text-strong);",
    "}",
    "",
    ".workspace .inspector .btn.danger {",
    "  border-color: color-mix(in srgb, #ef4444 44%, var(--ws-border-soft));",
    "  color: color-mix(in srgb, #dc2626 72%, var(--ws-text));",
    "}",
    "",
    ".workspace .inspector .editor {",
    "  border: 1px solid var(--ws-border-soft);",
    "  background: var(--ws-input-bg);",
    "  color: var(--ws-input-text);",
    "}",
    "",
    "/* ============================= */",
    "/* 专注区（番茄 + 任务 + 休息 + 统计） */",
    "/* ============================= */",
    ".workspace .focus-hub,",
    ".workspace .focus-main {",
    "  color: var(--ws-text);",
    "}",
    "",
    ".workspace .timer-card,",
    ".workspace .planner-card,",
    ".workspace .stats-card,",
    ".workspace .break-control-bar,",
    ".workspace .break-prompt-card,",
    ".workspace .focus-task-item {",
    "  border: 1px solid var(--ws-border);",
    "  background: color-mix(in srgb, var(--ws-panel-bg) 92%, transparent);",
    "}",
    "",
    ".workspace .focus-hub .btn,",
    ".workspace .focus-task-item .btn,",
    ".workspace .target-input button {",
    "  border: 1px solid var(--ws-border-soft);",
    "  background: var(--ws-btn-bg);",
    "  color: var(--ws-text);",
    "}",
    "",
    ".workspace .focus-hub .btn.primary,",
    ".workspace .focus-task-item .btn.primary {",
    "  border-color: var(--ws-border-active);",
    "  background: linear-gradient(180deg, color-mix(in srgb, var(--ws-accent) 26%, #334155) 0%, #273a57 100%);",
    "  color: #f8fafc;",
    "}",
    "",
    ".workspace .focus-hub .chip,",
    ".workspace .focus-hub .badge {",
    "  border: 1px solid var(--ws-badge-border);",
    "  background: var(--ws-badge-bg);",
    "  color: var(--ws-accent);",
    "}",
    "",
    ".workspace .break-fullscreen {",
    "  background: color-mix(in srgb, var(--ws-workspace-bg) 90%, #000 10%);",
    "}",
    "",
    ".workspace .break-fullscreen .break-fullscreen-card {",
    "  border: 1px solid var(--ws-border-active);",
    "  background: color-mix(in srgb, var(--ws-panel-bg) 95%, transparent);",
    "}",
    "",
    "/* ============================= */",
    "/* 设置弹窗（主题设置区域） */",
    "/* ============================= */",
    ".workspace .settings-backdrop {",
    "  background: color-mix(in srgb, #020617 38%, transparent);",
    "}",
    "",
    ".workspace .settings-dialog {",
    "  border: 1px solid var(--ws-border);",
    "  background: var(--ws-panel-bg);",
    "}",
    "",
    ".workspace .settings-dialog .setting-row,",
    ".workspace .settings-dialog .setting-stack {",
    "  color: var(--ws-text);",
    "}",
    "",
    ".workspace .settings-dialog select,",
    ".workspace .settings-dialog .css-editor {",
    "  border: 1px solid var(--ws-border-soft);",
    "  background: var(--ws-btn-bg);",
    "  color: var(--ws-text);",
    "}",
    "",
    ".workspace .settings-dialog .theme-card,",
    ".workspace .settings-dialog .clear-btn {",
    "  border: 1px solid var(--ws-border-soft);",
    "  background: var(--ws-btn-bg);",
    "  color: var(--ws-text);",
    "}",
    "",
    ".workspace .settings-dialog .theme-card.active {",
    "  border-color: var(--ws-border-active);",
    "  box-shadow: 0 0 0 1px color-mix(in srgb, var(--ws-accent) 25%, transparent);",
    "}",
  ].join("\n");
}

function buildSelectorIndexSection() {
  const lines = [
    "",
    "/* ============================= */",
    "/* 全组件选择器索引（精准覆写用） */",
    "/* ============================= */",
    "/*",
    "说明：",
    "1) 上方模块分组已给出默认视觉样式。",
    "2) 下方是工作台已使用的完整类名索引，便于做细粒度覆写。",
    "3) 覆写时请复制需要的选择器并添加属性，不建议全量粘贴空块。",
    "",
  ];
  for (const className of WORKSPACE_SELECTOR_INDEX) {
    lines.push(`.workspace .${className}`);
  }
  lines.push("*/");
  return lines.join("\n");
}

export function buildWorkspaceDefaultThemeTemplate() {
  const lines = [
    "/*",
    "Desk Tidy Workspace - 自定义主题完整默认模板",
    "",
    "使用方式：",
    "1) 在工作台设置里点击“复制完整模板”并粘贴到“自定义主题”。",
    "2) 模板已包含变量 + 主要组件默认样式，不再是空占位。",
    "3) 优先改变量（全局生效），再按模块改局部。",
    "4) 建议始终使用 .workspace 前缀，避免影响其他页面。",
    "*/",
    "",
    buildThemeTokenSection(),
    buildModuleDefaultSection(),
    buildSelectorIndexSection(),
  ];
  return lines.join("\n");
}
